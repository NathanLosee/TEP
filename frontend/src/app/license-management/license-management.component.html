<div class="license-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <mat-icon class="page-icon">verified_user</mat-icon>
        <h1>License Management</h1>
      </div>
    </div>
  </div>

  @if (isLoading) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Loading license status...</p>
    </div>
  } @else {
    <!-- Current License Status -->
    <mat-card class="status-card" [ngClass]="licenseStatus?.is_active ? 'status-card-active' : 'status-card-inactive'">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>{{ licenseStatus?.is_active ? 'verified' : 'gpp_bad' }}</mat-icon>
          Current License Status
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        @if (licenseStatus?.is_active) {
          <div class="status-active">
            <div class="status-badge active">
              <mat-icon>check_circle</mat-icon>
              <span>Active</span>
            </div>
            <div class="license-details">
              <div class="detail-row">
                <mat-icon>vpn_key</mat-icon>
                <div>
                  <label>License Key</label>
                  <span class="license-key">{{ licenseStatus?.license_key }}</span>
                </div>
              </div>
              <div class="detail-row">
                <mat-icon>event</mat-icon>
                <div>
                  <label>Activated</label>
                  <span>{{ licenseStatus?.activated_at | date:'medium' }}</span>
                </div>
              </div>
            </div>
          </div>
          <div class="card-actions">
            <button
              mat-raised-button
              color="warn"
              (click)="deactivateLicense()"
              [disabled]="isActivating"
            >
              <mat-icon>remove_circle</mat-icon>
              Deactivate License
            </button>
          </div>
        } @else {
          <div class="status-inactive">
            <div class="status-badge inactive">
              <mat-icon>warning</mat-icon>
              <span>Not Licensed</span>
            </div>
            <p class="status-message">Admin features are currently locked. Please activate a license below.</p>
          </div>
        }
      </mat-card-content>
    </mat-card>

    <!-- License Activation Form -->
    @if (!licenseStatus?.is_active) {
      <mat-card class="activation-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>vpn_key</mat-icon>
            Activate License
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <form [formGroup]="licenseForm" (ngSubmit)="activateLicense()">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>License Key</mat-label>
              <textarea
                matInput
                formControlName="license_key"
                rows="4"
                placeholder="ABLE-ACID-AGED-ALSO AREA-ARMY-AWAY-BABY ..."
                required
              ></textarea>
              <mat-hint>Word format (64 words) or hex format (128 characters)</mat-hint>
              @if (licenseForm.get('license_key')?.hasError('invalidFormat')) {
                <mat-error>{{ licenseForm.get('license_key')?.getError('invalidFormat')?.message || 'Invalid license key format' }}</mat-error>
              }
              @if (licenseForm.get('license_key')?.hasError('required')) {
                <mat-error>License key is required</mat-error>
              }
            </mat-form-field>

            <div class="button-row">
              <button
                mat-raised-button
                color="primary"
                type="submit"
                [disabled]="!licenseForm.valid || isActivating"
              >
                <mat-spinner *ngIf="isActivating" diameter="20"></mat-spinner>
                <mat-icon *ngIf="!isActivating">key</mat-icon>
                {{ isActivating ? 'Activating...' : 'Activate License' }}
              </button>
            </div>
          </form>
        </mat-card-content>
      </mat-card>
    }

    <!-- Help Information -->
    <mat-card class="help-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>help_outline</mat-icon>
          License Information
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="help-section">
          <h4>
            <mat-icon>info</mat-icon>
            About Licensing
          </h4>
          <p>
            This application requires a valid license to access administrative features.
            Core timeclock functionality remains available without a license.
          </p>
        </div>
        <div class="help-section">
          <h4>
            <mat-icon>star</mat-icon>
            License Features
          </h4>
          <ul>
            <li>Lifetime license (no expiration)</li>
            <li>One license per server installation</li>
            <li>License is bound to this specific machine</li>
            <li>Unlocks all administrative features</li>
          </ul>
        </div>
        <div class="help-section">
          <h4>
            <mat-icon>wifi</mat-icon>
            Activation Requirements
          </h4>
          <p>
            License activation requires a one-time internet connection to the MonteVista
            license server. After activation, the license is stored locally and no further
            internet connection is required.
          </p>
        </div>
        <div class="help-section">
          <h4>
            <mat-icon>support_agent</mat-icon>
            Need Help?
          </h4>
          <p>
            Contact your system administrator or MonteVista support for assistance
            with obtaining or activating a license.
          </p>
        </div>
      </mat-card-content>
    </mat-card>
  }
</div>
