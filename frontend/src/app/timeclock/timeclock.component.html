<div class="timeclock-layout">
  <!-- Left Column: Branding -->
  <div class="left-column">
    <mat-toolbar>
      <mat-toolbar-row>
        <mat-icon>access_time</mat-icon>
      </mat-toolbar-row>
      <mat-toolbar-row>
        <h1>Timeclock</h1>
      </mat-toolbar-row>
      <mat-toolbar-row>
        <p>{{ currentDateAndTime | date : "EEEE, MMMM d, yyyy - h:mm a" }}</p>
      </mat-toolbar-row>
    </mat-toolbar>

    <div class="logo-container">
      <img src="monteVista.png" alt="MonteVista Logo" />
    </div>
  </div>

  <!-- Right Column: Actions and Status -->
  <div class="right-column">
    <!-- Badge Number and Actions -->
    <div class="actions-section">
      <mat-form-field>
        <mat-label>Badge Number</mat-label>
        <input matInput name="badgeNumber" required [(ngModel)]="badgeNumber" />
        @if (badgeNumber) {
        <button
          matSuffix
          mat-icon-button
          aria-label="Clear"
          (click)="badgeNumber = ''"
        >
          <mat-icon>close</mat-icon>
        </button>
        }
      </mat-form-field>

      <button mat-raised-button (click)="clockInOut()" [disabled]="!badgeNumber">
        Clock In/Out
      </button>

      <button mat-raised-button (click)="checkStatus()" [disabled]="!badgeNumber">
        Check Status
      </button>

      <button mat-raised-button (click)="viewHistory()" [disabled]="!badgeNumber">
        View My History
      </button>
    </div>

    <!-- Device Registration Status Indicator -->
    <mat-card class="device-status-card">
      <mat-card-content>
        <div class="device-status-indicator">
          <mat-icon [class.registered]="isDeviceRegistered" [class.unregistered]="!isDeviceRegistered">
            {{ isDeviceRegistered ? 'business' : 'public' }}
          </mat-icon>
          <div class="status-text">
            @if (isDeviceRegistered) {
              <strong>Internal Device</strong>
            } @else {
              <strong>External Device</strong>
            }
            @if (isDeviceRegistered && deviceName) {
              <span class="device-name">{{ deviceName }}</span>
            }
            @if (!isDeviceRegistered) {
              <span class="warning-text">Employees need External Clocking permission to clock in/out using this device</span>
            }
          </div>
        </div>

        <!-- Device ID Recovery Section (shown when device is not registered) -->
        @if (!isDeviceRegistered && !showRecoveryForm) {
          <div class="recovery-link">
            <button mat-button (click)="showRecoveryForm = true">
              <mat-icon>vpn_key</mat-icon>
              Have a device ID?
            </button>
          </div>
        }

        @if (showRecoveryForm) {
          <div class="recovery-form">
            <h3>Recover Device Registration</h3>
            <p>Enter the device ID from this device's label</p>
            <p class="format-hint">Format: WORD-WORD-WORD-NUMBER</p>
            <mat-form-field appearance="outline" class="recovery-input">
              <mat-label>Device ID</mat-label>
              <input matInput [(ngModel)]="recoveryCode" placeholder="EAGLE-RIVER-MOUNTAIN-42" [disabled]="isRecovering" />
            </mat-form-field>
            <div class="recovery-actions">
              <button mat-button (click)="cancelRecovery()">Cancel</button>
              <button mat-raised-button color="primary" (click)="recoverDevice()" [disabled]="!recoveryCode || isRecovering">
                @if (isRecovering) {
                  <mat-icon>hourglass_empty</mat-icon>
                  Recovering...
                } @else {
                  <mat-icon>restore</mat-icon>
                  Recover
                }
              </button>
            </div>
            @if (recoveryError) {
              <div class="error-message">
                <mat-icon>error</mat-icon>
                {{ recoveryError }}
              </div>
            }
          </div>
        }
      </mat-card-content>
    </mat-card>
  </div>
</div>
