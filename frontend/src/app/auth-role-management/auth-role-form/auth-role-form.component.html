<!-- Create/Edit Role Form -->
<mat-card class="form-card">
  <mat-card-header>
    <mat-card-title>
      <mat-icon>add</mat-icon>
      Create/Edit Auth Role
    </mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <form [formGroup]="authRoleForm">
      <!-- Role Name -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Role Name</mat-label>
        <input
          matInput
          formControlName="name"
          placeholder="Enter role name"
          maxlength="50"
        />
        <mat-error *ngIf="authRoleForm.get('name')?.hasError('required')">
          Role name is required
        </mat-error>
      </mat-form-field>

      <!-- Permissions Selection -->
      <div class="permissions-section">
        <h3>Permissions</h3>
        <p class="permissions-description">
          Select the permissions this role should have. Permissions are grouped
          by feature category.
        </p>

        <mat-accordion class="permissions-accordion">
          <mat-expansion-panel
            *ngFor="let category of Object.keys(availablePermissions)"
            class="permission-category"
          >
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>{{ getCategoryIcon(category) }}</mat-icon>
                {{ getCategoryName(category) }}
              </mat-panel-title>
              <mat-panel-description>
                {{ getSelectedPermissionsCount(category) }} /
                {{ Object.keys(availablePermissions[category]).length }}
                selected
              </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="permission-list">
              <div
                *ngFor="let permission of availablePermissions[category]"
                class="permission-item"
              >
                <mat-checkbox
                  [checked]="isPermissionSelected(permission)"
                  (change)="togglePermission(permission)"
                >
                  <span class="permission-code">{{ permission.resource }}</span>
                  <span class="permission-description">{{
                    permission.description
                  }}</span>
                </mat-checkbox>
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>

        <div
          class="selected-permissions-summary"
          *ngIf="selectedPermissions.size > 0"
        >
          <h4>Selected Permissions ({{ selectedPermissions.size }})</h4>
          <div class="permission-chips">
            <mat-chip-set>
              <mat-chip
                *ngFor="let permission of Array.from(selectedPermissions)"
                removable
                (removed)="togglePermission(permission)"
              >
                {{ permission }}
                <mat-icon matChipRemove>cancel</mat-icon>
              </mat-chip>
            </mat-chip-set>
          </div>
        </div>
      </div>
    </form>
  </mat-card-content>

  <mat-card-actions>
    <button
      mat-button
      type="button"
      (click)="cancelForm()"
      [disabled]="isLoading"
    >
      Cancel
    </button>
    <button
      mat-raised-button
      color="primary"
      (click)="submitForm()"
      [disabled]="authRoleForm.invalid || isLoading"
    >
      <mat-progress-spinner
        *ngIf="isLoading"
        diameter="20"
        mode="indeterminate"
      >
      </mat-progress-spinner>
      <span *ngIf="!isLoading"> Create/Update Role </span>
    </button>
  </mat-card-actions>
</mat-card>
