<div class="device-management-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <mat-icon class="page-icon">web</mat-icon>
        <h1>Registered Browsers</h1>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <mat-card class="content-card">
    <mat-tab-group class="main-tabs">
      <!-- My Browsers Tab -->
      <mat-tab label="My Browsers" [disabled]="isLoading">
        <div class="tab-content">
          <!-- Current Browser Status Card -->
          <mat-card class="browser-status-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>computer</mat-icon>
                Current Browser Status
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="browser-status">
                <div class="status-info">
                  <div class="status-row">
                    <span class="status-label">Browser Name:</span>
                    <span *ngIf="currentBrowserName">{{
                      currentBrowserName
                    }}</span>
                    <span class="no-uuid" *ngIf="!currentBrowserName"
                      >Not set</span
                    >
                  </div>
                  <div class="status-row">
                    <span class="status-label">Browser UUID:</span>
                    <code class="uuid-code" *ngIf="currentBrowserUuid">{{
                      currentBrowserUuid
                    }}</code>
                    <span class="no-uuid" *ngIf="!currentBrowserUuid"
                      >Not set</span
                    >
                  </div>
                  <div class="status-row">
                    <span class="status-label">Registration Status:</span>
                    <mat-chip
                      *ngIf="isCurrentBrowserRegistered"
                      class="status-chip registered"
                    >
                      <mat-icon>check_circle</mat-icon>
                      Registered
                    </mat-chip>
                    <mat-chip
                      *ngIf="!isCurrentBrowserRegistered && currentBrowserUuid"
                      class="status-chip unregistered"
                    >
                      <mat-icon>warning</mat-icon>
                      Unregistered
                    </mat-chip>
                    <mat-chip
                      *ngIf="!currentBrowserUuid"
                      class="status-chip no-uuid"
                    >
                      <mat-icon>info</mat-icon>
                      No UUID
                    </mat-chip>
                  </div>
                </div>
                <div class="status-actions">
                  <button
                    mat-stroked-button
                    type="button"
                    color="warn"
                    (click)="clearBrowserUuid()"
                    [disabled]="!currentBrowserUuid"
                    matTooltip="Clear UUID from this browser"
                  >
                    <mat-icon>clear</mat-icon>
                    Unregister Browser
                  </button>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Register New Browser Section -->
          <mat-card class="register-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>add_circle</mat-icon>
                Register New Browser
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <form [formGroup]="registerForm" (ngSubmit)="registerBrowser()">
                <div class="register-form">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Browser Name</mat-label>
                    <input
                      matInput
                      formControlName="browser_name"
                      placeholder="e.g., My Work Computer"
                    />
                    <mat-icon matSuffix>computer</mat-icon>
                    <mat-error
                      *ngIf="
                        registerForm.get('browser_name')?.hasError('required')
                      "
                    >
                      Browser name is required
                    </mat-error>
                    <mat-error
                      *ngIf="
                        registerForm.get('browser_name')?.hasError('minlength')
                      "
                    >
                      Browser name must be at least 3 characters
                    </mat-error>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Browser UUID</mat-label>
                    <input
                      matInput
                      formControlName="browser_uuid"
                      placeholder="Browser identifier"
                      readonly
                    />
                    <mat-icon matSuffix>fingerprint</mat-icon>
                    <mat-error
                      *ngIf="
                        registerForm.get('browser_uuid')?.hasError('required')
                      "
                    >
                      Browser UUID is required
                    </mat-error>
                  </mat-form-field>

                  <div class="button-group">
                    <button
                      mat-raised-button
                      type="button"
                      (click)="generateBrowserUUID()"
                      [disabled]="isRegistering"
                    >
                      <mat-icon>refresh</mat-icon>
                      Generate UUID
                    </button>
                    <button
                      mat-raised-button
                      color="primary"
                      type="submit"
                      [disabled]="registerForm.invalid || isRegistering"
                      [disableIfNoPermission]="'registered_browser.create'"
                    >
                      <mat-progress-spinner
                        *ngIf="isRegistering"
                        diameter="20"
                        mode="indeterminate"
                      ></mat-progress-spinner>
                      <mat-icon *ngIf="!isRegistering">add</mat-icon>
                      <span *ngIf="!isRegistering">Register Browser</span>
                    </button>
                  </div>
                </div>
              </form>
            </mat-card-content>
          </mat-card>

          <!-- Browsers Table -->
          <mat-card class="table-card">
            <mat-card-header>
              <mat-card-title
                >Registered Browsers ({{ browsers.length }})</mat-card-title
              >
            </mat-card-header>

            <mat-card-content>
              <app-generic-table
                [data]="browsers"
                [columns]="columns"
                [actions]="actions"
                [isLoading]="isLoading"
                emptyIcon="web"
                emptyTitle="No browsers registered"
                emptyMessage="Register your first browser to enable external clocking."
                (actionClick)="onTableAction($event)"
              >
                <!-- Custom template for browser_uuid column -->
                <ng-template appTableCell="browser_uuid" let-browser>
                  <code class="uuid-code">{{ browser.browser_uuid }}</code>
                </ng-template>

                <!-- Custom template for is_active column -->
                <ng-template appTableCell="is_active" let-browser>
                  <mat-chip
                    *ngIf="browser.is_active"
                    class="status-chip active"
                  >
                    Active
                  </mat-chip>
                  <mat-chip
                    *ngIf="!browser.is_active"
                    class="status-chip inactive"
                  >
                    Inactive
                  </mat-chip>
                </ng-template>
              </app-generic-table>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>
    </mat-tab-group>
  </mat-card>
</div>
